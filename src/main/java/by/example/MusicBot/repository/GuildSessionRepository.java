package by.example.MusicBot.repository;

import by.example.MusicBot.domain.GuildSession;

import java.util.Optional;

/**
 * Repository для управления сессиями гильдий.
 * 
 * <p>Этот интерфейс определяет контракт для доступа к сессиям GuildSession.
 * Он абстрагирует способ хранения сессий от бизнес-логики.
 * 
 * <h3>Зачем нужен этот слой?</h3>
 * <ul>
 *     <li><b>Изоляция:</b> Service слой не знает, где хранятся сессии (в памяти, БД, кэше)</li>
 *     <li><b>Тестируемость:</b> Можно подменить реализацию на mock для тестов</li>
 *     <li><b>Заменяемость:</b> Можно сменить хранилище без изменения бизнес-логики</li>
 * </ul>
 * 
 * <h3>Пример использования:</h3>
 * <pre>{@code
 * GuildSessionRepository repo = new InMemoryGuildSessionRepository();
 * GuildSession session = repo.getOrCreate(123456789L);
 * session.getQueue().add(track);
 * }</pre>
 * 
 * @see GuildSession
 * @see InMemoryGuildSessionRepository
 */
public interface GuildSessionRepository {

    /**
     * Получает сессию для гильдии или создаёт новую.
     * 
     * <p>Это основной метод для получения сессии. Он гарантирует,
     * что сессия всегда будет возвращена — либо существующая,
     * либо новая если её ещё нет.
     * 
     * <p>Пример использования в сервисе:
     * <pre>{@code
     * // Когда пользователь вызывает !play
     * GuildSession session = repository.getOrCreate(guildId);
     * session.getQueue().add(track);
     * }</pre>
     * 
     * @param guildId уникальный ID гильдии (сервера Discord)
     * @return сессия для этой гильдии (никогда не возвращает null)
     */
    GuildSession getOrCreate(long guildId);

    /**
     * Получает сессию для гильдии без создания новой.
     * 
     * <p>В отличие от {@link #getOrCreate(long)}, этот метод
     * возвращает Optional, который может быть пустым.
     * 
     * <p>Используется когда нужно проверить, существует ли сессия,
     * без её создания. Например, для проверки активности бота
     * на сервере.
     * 
     * @param guildId уникальный ID гильдии
     * @return Optional с сессией или пустой Optional если сессии нет
     */
    Optional<GuildSession> get(long guildId);

    /**
     * Удаляет сессию гильдии из хранилища.
     * 
     * <p>Используется когда бот покидает сервер или когда
     * нужно полностью сбросить состояние бота на сервере.
     * 
     * <p>Важно: после удаления сессии все данные о очереди,
     * текущем треке и настройках будут потеряны.
     * 
     * @param guildId ID гильдии, сессию которой нужно удалить
     */
    void remove(long guildId);

    /**
     * Проверяет, существует ли сессия для гильдии.
     * 
     * <p>Быстрый способ проверить наличие сессии без её получения.
     * Может использоваться для оптимизации — чтобы не создавать
     * объект сессии, если нужно только проверить её наличие.
     * 
     * @param guildId ID гильдии для проверки
     * @return true если сессия существует
     */
    boolean exists(long guildId);

    /**
     * Очищает все сессии из хранилища.
     * 
     * <p>Используется при остановке бота или для полного сброса
     * состояния. Все активные воспроизведения будут потеряны.
     * 
     * <p>Внимание: этот метод не отключает бота от голосовых
     * каналов — это нужно делать отдельно.
     */
    void clearAll();

    /**
     * Возвращает количество активных сессий.
     * 
     * <p>Активная сессия — это сессия, где что-то воспроизводится
     * или есть треки в очереди.
     * 
     * <p>Используется для мониторинга и статистики:
     * <ul>
     *     <li>Сколько серверов используют бота прямо сейчас</li>
     *     <li>Мониторинг нагрузки на бота</li>
     * </ul>
     * 
     * @return количество активных сессий
     */
    int getActiveSessionCount();
}
